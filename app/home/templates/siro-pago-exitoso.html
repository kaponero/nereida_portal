{% extends "accounts/base.html" %}

{% block title %}Pago exitoso{% endblock %}

{% block links %}
<link rel="stylesheet"
    href="{{ url_for('static', filename='asset/css/pago_exitoso.css') }}?v={{ config.APP_VERSION }}">
{% endblock %}

{% block content %}

<!-- üîä SONIDO -->
<audio id="pay-sound" preload="auto"
       src="{{ url_for('static', filename='asset/media/success.mp3') }}?v={{ config.APP_VERSION }}">
</audio>

<!-- Estado inicial -->
<div id="loading-view"
     style="display:flex; justify-content:center; align-items:center; height:75vh; flex-direction:column;">
    <div class="spinner"></div>
    <p style="margin-top:15px; color:#555;">
        Procesando pago...
    </p>
</div>

<!-- Vista final -->
<div id="animacion" style="display:none;">
    <div class="full-green"></div>
    <div class="white-circle"></div>

    <div class="final-view">
        <svg class="final-icon" viewBox="0 0 50 50" aria-hidden="true">
            <circle cx="25" cy="25" r="25" fill="#25AE88"/>
            <polyline points="38,15 22,33 12,25"
                fill="none" stroke="white"
                stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {%if voucher.state == 'process_payment_ok' %}
            <div class="final-title">Pago exitoso</div>
        {% elif voucher.state == 'processing_payment' %}
            <div class="final-title">Su pago se procesara en las siguientes 24 hs h√°biles </div>
        {% endif %}

     <!--   <div class="final-amount">
            {{ voucher.amount_to_pay_today | currencyformat(voucher.currency) }}
        </div>-->

        <div class="mt-4">
            <a href="{{ url_for('home_blueprint.index') }}"
               class="btn btn-light">
                Volver al inicio
            </a>
        </div>
    </div>
</div>

{% endblock content %}

{% block javascripts %}
<script>
    setTimeout(() => {
        const spinner = document.querySelector(".spinner");
        const animacion = document.getElementById("animacion");
        const loadingView = document.getElementById("loading-view");

        if (spinner) spinner.style.display = "none";
        if (loadingView) loadingView.style.display = "none";
        animacion.style.display = "block";

        // üîä Intentar reproducir sonido
        setTimeout(() => {
            const audio = document.getElementById("pay-sound");
            if (audio) {
                audio.play().catch(() => {
                    console.warn('Autoplay bloqueado por el navegador');
                });
            }
        }, 1200);

    }, 2000);
</script>

<script type="text/javascript"
        src="{{ url_for('static', filename='asset/js/main.js') }}?v={{ config.APP_VERSION }}">
</script>

{% endblock javascripts %}
